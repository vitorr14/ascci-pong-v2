// Adicionar sons de batida e ponto
const hitSound = new Audio('hit.wav');
const scoreSound = new Audio('score.mp3');

// Configurações do jogo
const PADDLE_WIDTH = 10;
const PADDLE_HEIGHT = 80;
const BALL_SIZE = 10;
const WIN_SCORE = 10; // Limite de pontos para vencer

// Raquetes
let paddle1Y = (canvas.height - PADDLE_HEIGHT) / 2;
let paddle2Y = (canvas.height - PADDLE_HEIGHT) / 2;
const paddleSpeed = 5;
const ballSpeed = 4;

let ballX = canvas.width / 2;
let ballY = canvas.height / 2;
let ballSpeedX = ballSpeed;
let ballSpeedY = ballSpeed;

let score1 = 0;
let score2 = 0;

// Função para desenhar a raquete
function drawPaddle(x, y) {
    ctx.fillStyle = "#00ff00";  // Cor verde neon para as raquetes
    ctx.fillRect(x, y, PADDLE_WIDTH, PADDLE_HEIGHT);
}

// Função para desenhar a bolinha
function drawBall() {
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.arc(ballX, ballY, BALL_SIZE, 0, Math.PI * 2);
    ctx.fill();
}

// Função para desenhar o placar
function drawScore() {
    ctx.font = "20px Arial";
    ctx.fillText(`${score1} : ${score2}`, canvas.width / 2 - 50, 30);
}

// Função de movimentação da bolinha
function moveBall() {
    ballX += ballSpeedX;
    ballY += ballSpeedY;

    // Colisão com as paredes superior e inferior
    if (ballY <= 0 || ballY >= canvas.height) {
        ballSpeedY = -ballSpeedY;
    }

    // Colisão com as raquetes
    if (ballX <= PADDLE_WIDTH && ballY >= paddle1Y && ballY <= paddle1Y + PADDLE_HEIGHT) {
        ballSpeedX = -ballSpeedX;
        hitSound.play();  // Toca o som de batida
    }
    if (ballX >= canvas.width - PADDLE_WIDTH - BALL_SIZE && ballY >= paddle2Y && ballY <= paddle2Y + PADDLE_HEIGHT) {
        ballSpeedX = -ballSpeedX;
        hitSound.play();  // Toca o som de batida
    }

    // Pontuação
    if (ballX <= 0) {
        score2++;
        scoreSound.play();  // Toca o som de ponto
        resetBall();
    } else if (ballX >= canvas.width) {
        score1++;
        scoreSound.play();  // Toca o som de ponto
        resetBall();
    }
}

// Função para resetar a bolinha
function resetBall() {
    ballX = canvas.width / 2;
    ballY = canvas.height / 2;
    ballSpeedX = -ballSpeedX;
    ballSpeedY = ballSpeed;
}

// Função para movimentar as raquetes
function movePaddles() {
    document.addEventListener("keydown", function(event) {
        if (event.key === "ArrowUp" && paddle2Y > 0) {
            paddle2Y -= paddleSpeed;
        }
        if (event.key === "ArrowDown" && paddle2Y < canvas.height - PADDLE_HEIGHT) {
            paddle2Y += paddleSpeed;
        }
        if (event.key === "w" && paddle1Y > 0) {
            paddle1Y -= paddleSpeed;
        }
        if (event.key === "s" && paddle1Y < canvas.height - PADDLE_HEIGHT) {
            paddle1Y += paddleSpeed;
        }
    });
}

// Função para desenhar a tela de vitória
function drawVictoryScreen(winner) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.font = "40px Arial";
    ctx.fillStyle = "white";
    ctx.fillText(`${winner} venceu!`, canvas.width / 2 - 120, canvas.height / 2 - 40);
    ctx.fillText("Pressione R para reiniciar", canvas.width / 2 - 150, canvas.height / 2 + 40);
}

// Função principal que roda o jogo
function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawPaddle(0, paddle1Y);
    drawPaddle(canvas.width - PADDLE_WIDTH, paddle2Y);
    drawBall();
    drawScore();
    moveBall();

    // Verifica se algum jogador ganhou
    if (score1 >= WIN_SCORE) {
        drawVictoryScreen("Jogador 1");
        return;
    } else if (score2 >= WIN_SCORE) {
        drawVictoryScreen("Jogador 2");
        return;
    }

    requestAnimationFrame(update); // Continuação do loop
}

// Função para iniciar o jogo
function startGame() {
    document.getElementById("start-screen").style.display = "none";
    document.getElementById("pong").style.display = "block";
    update(); // Inicia o loop do jogo
}

// Função para reiniciar o jogo
document.addEventListener("keydown", function(event) {
    if (event.key === "r") {
        score1 = 0;
        score2 = 0;
        ballX = canvas.width / 2;
        ballY = canvas.height / 2;
        ballSpeedX = ballSpeed;
        ballSpeedY = ballSpeed;
        paddle1Y = paddle2Y = (canvas.height - PADDLE_HEIGHT) / 2;
        update(); // Reinicia o loop do jogo
    }
});

// Começar o jogo quando qualquer tecla for pressionada
document.addEventListener("keydown", startGame);
